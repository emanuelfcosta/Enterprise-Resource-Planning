{% extends "index.html" %}

{% block content %}

<!-- as the functionality of the purchase is 
practically the same as that of the sale,
all the code was reused. Changes were made
where necessary which is on the part of the 
supplier, purchase price, increase in stock, etc. -->


<div class="content-header">
  <div class="container">
    <div class="row justify-content-end">
      {{user_name}}  
    </div>
  </div>
    <div class="container">
    <div class="row mb-2">
    <div class="col-sm-6">
    <h1 class="m-0"> New Purchase </h1>
    </div>
    <div class="col-sm-6">
    <ol class="breadcrumb float-sm-right">
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item"><a href="/purchases">Purchases</a></li>
    
    </ol>
    </div>
    </div>
    </div>

  <br>

  <script>
    function add_products_sale(element) {
  
  
      
      if(isNaN( convert_decimal_value(document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value))){
        swal('Warning!!!', 'The Amount must be a number! ', 'warning');
               
               return false;  
  
      }   
     
  
  var table = document.getElementById("grid");
  var row = table.insertRow(1);
  
  var cell_id = row.insertCell(0);
  var cell_name = row.insertCell(1);
  var cell_price = row.insertCell(2);
  var cell_amount = row.insertCell(3);
  var cell_subtotal = row.insertCell(4);
  var cell_actions = row.insertCell(5);   
  
  cell_id.innerHTML = document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML;
  cell_name.innerHTML = document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[1].innerHTML;
  cell_price.innerHTML = document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[2].innerHTML;
  cell_amount.innerHTML = convert_decimal_value(document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value);
  cell_subtotal.innerHTML = 
 
          (document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[2].innerHTML * convert_decimal_value(document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value)).toFixed(2); ;            
         
      
      cell_actions.innerHTML = '<button type="button"  class="btn btn-xs btn-danger" data-toggle="tooltip" data-placement="top"  onclick= remove_product_sale(this)>' +
  '<i class="fa fa-trash"></i> Delete</button>'; 
  
     // updates (increases) the quantity of sale items

   document.getElementById("qty_prod_sale").innerHTML = 
       
        parseInt(document.getElementById("qty_prod_sale").innerHTML) + parseInt(document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value);
       
      // UPDATE(INCREASE) THE VALUE OF THE SALE
  
      document.getElementById("sale_value").innerHTML = 
  (parseFloat(document.getElementById("sale_value").innerHTML) +
  parseFloat(document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[2].innerHTML * convert_decimal_value(document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value))).toFixed(2);     
      
  
  
  //UPDATE THE BALANCE OF THE PART OF THE INSTALLMENT
          
  document.getElementById("value_balance_installment").innerHTML = document.getElementById("sale_value").innerHTML;  
  
  //SET QUANTITY TO 1
   document.getElementById("qtde"+document.getElementById("gridproducts").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML).value = 1;        
  
  
  
  close_modal_products();
  
  }
  //--------------------------------------------------------------
  function close_modal_products(){
      $('#modalProducts').modal('hide');    
      }
  //--------------------------------------------------------------
  function remove_product_sale(element) {
  
       // UPDATE(DECREASE) QUANTITY OF SALE ITEMS        
   document.getElementById("qty_prod_sale").innerHTML =    parseFloat(document.getElementById("qty_prod_sale").innerHTML) - 
   
   parseFloat(document.getElementById("grid").rows[element.parentNode.parentNode.rowIndex].cells[3].innerHTML);
  
  
  
  // UPDATE(DECREASE) THE SALE AMOUNT        
         
  
  document.getElementById("sale_value").innerHTML = (parseFloat(document.getElementById("sale_value").innerHTML) -
  parseFloat(document.getElementById("grid").rows[element.parentNode.parentNode.rowIndex].cells[4].innerHTML)).toFixed(2);    
           
  
  
    // DELETE ROW
          
    document.getElementById("grid").deleteRow(element.parentNode.parentNode.rowIndex);
  
    //UPDATE THE INSTALLMENT BALANCE
          
   document.getElementById("value_balance_installment").innerHTML = document.getElementById("sale_value").innerHTML;        
          
  
  }
  //--------------------------------------------------------------
  // CONVERT COMMA TO POINT
  
  function convert_decimal_value(element){
            
      var valor_with_point = element.replace(',','.');
      
    
      element =  parseFloat(valor_with_point).toFixed(2); 
    
      return element;
      
      }
    //----------------------------------------------------
  
    function check_fields() {
  
  
  var v_date_sale = document.getElementById('date_sale').value;
  

  
  //cost center
  if (!$("#cost_center").val()) {
    swal('Warning!!!', 'The Purchase must have a cost center!' , 'warning');
  
  return false;
  }
  
  
  
  // client
  if (!$("#client").val()) {
    swal('Warning!!!', 'The Purchase must have a supplier!' , 'warning');
  
  return false;
  }
  
  //payment method
  if (!$("#payment_method").val()) {
    swal('Warning!!!', 'The Purchase must have a Payment Method!' , 'warning');
  
  return false;
  }
  // date
  
  
    if (v_date_sale == ""){
    
  
    swal('Warning!!!', 'Purchase must have a valid date!' , 'warning');
  
    return false;
  }
  
  //products
  
  if (document.getElementById("grid").rows.length < 2){
  
    swal('Warning!!!', 'Purchase must have products!' , 'warning');
  
    return false;
  
  }
  
  
  
  var bill_in_cash = document.getElementById("check_in_cash").checked;
          
          if (bill_in_cash == true){ 
               // sale payment in cash
             
              
               document.getElementById('v_sale_value_cash').innerHTML =
               document.getElementById('sale_value').innerHTML;
              
               $('#modalSaleCash').modal('show'); 
              
              // end - sale in cash
              
          } else{
  
            //installment sale
  
            // installments
  
            if (document.getElementById("gridbills").rows.length < 2){
  
            swal('Warning!!!', 'installment sale must have installments!' , 'warning');
  
            return false;
  
            }
  
            create_json_products();
            create_json_installments();
             
             // form submit
  
             document.getElementById("myForm").submit();
  
            }
  
  }
  
  
  
  
  // Function do Add installment to sale
  function add_installment_sale(){
     
          
          
          var account_expiration_date_value=document.getElementById('v_expiration_date_account').value;
          var value_installment_account=document.getElementById('v_value_installment_account').value;
          
          // 1 -EXPIRATION DATE ACCOUNT
          
          
          if (account_expiration_date_value == ""){
         
    
                swal('Warning!!!', 'Expiration date must be valid!' , 'warning');
  
                return false;
          }
          
         
           // 2 - VALUE INSTALLMENT ACCOUNT
          
           value_installment_account = convert_decimal_value(value_installment_account);
          
           if(isNaN(value_installment_account)){
               
                swal('Warning!!!', 'The value of installment account must be a number! ', 'warning');
               
                document.getElementById('v_value_installment_account').focus();
               
               return false;     
           }
          
           if(value_installment_account <= 0){
               
                swal('Warning!!!', 'The value of installment account must be greater than zero! ', 'warning');
               
                document.getElementById('v_value_installment_account').focus();
               
               return false;     
           }
          
          
          
          var bill_in_cash = document.getElementById("check_in_cash").checked;
          
          if (bill_in_cash == true){
               swal('Warning!!!', ' The cash sale must not have installments! ', 'warning');
              
          } else{
              
              var table = document.getElementById("gridbills");
              var row = table.insertRow(1);
              var cell_expiration = row.insertCell(0); 
              var cell_num_doc = row.insertCell(1); 
              var cell_value_installment = row.insertCell(2); 
              var cell_actions = row.insertCell(3); 
              
           
           cell_expiration.innerHTML = changeDateFormat(document.getElementById("v_expiration_date_account").value);
              //check if you have not informed anything in a doc, if so, put a dash
              if (! document.getElementById("v_number_account_document").value){
                cell_num_doc.innerHTML ='----';      
              }else{
                 cell_num_doc.innerHTML = document.getElementById("v_number_account_document").value;      
              }
              
            
            cell_value_installment.innerHTML = convert_decimal_value(document.getElementById("v_value_installment_account").value);        
            cell_actions.innerHTML = '<button type="button"  class="btn btn-xs btn-danger" data-toggle="tooltip" data-placement="top"  onclick= delete_installment_sale(this)>' + '<i class="fa fa-trash"></i> Delete</button>'; 
              
              //update released value
  
              document.getElementById("value_released_installments").innerHTML = (parseFloat(document.getElementById("value_released_installments").innerHTML) +
             parseFloat(convert_decimal_value(document.getElementById("v_value_installment_account").value))).toFixed(2);
  
  
              //update balance
  
              document.getElementById("value_balance_installment").innerHTML = 
                  
              (parseFloat(document.getElementById("sale_value").innerHTML)
  
              - parseFloat(document.getElementById("value_released_installments").innerHTML)).toFixed(2);
  
          }//else
  
       
      }// add sale installment
  
  // FUNCTION TO REMOVE INSTALLMENT (ACCOUNT) FROM THE PURCHASE
  function delete_installment_sale(element){
          
          //update released value
  
              document.getElementById("value_released_installments").innerHTML = (parseFloat(document.getElementById("value_released_installments").innerHTML) -
              parseFloat(document.getElementById("gridbills").rows[element.parentNode.parentNode.rowIndex].cells[2].innerHTML)).toFixed(2); ;
          
          //update balance
  
              document.getElementById("value_balance_installment").innerHTML = 
                  
              (parseFloat(document.getElementById("sale_value").innerHTML)
  
              - parseFloat(document.getElementById("value_released_installments").innerHTML)).toFixed(2);
  
          
          
       //DELETE ROW   
       document.getElementById("gridbills").deleteRow(element.parentNode.parentNode.rowIndex);   
      }
  
  //----------- CREATE JSON PRODUCTS ---------------------------------
  function create_json_products(){
  
         var i;
         var  my_json = '[';
        
         var  qty_commas = document.getElementById("grid").rows.length -2;
          // -2 because the fisrt row has the name of the fields
  
   // read all the products
         
         var table_products_sale = document.getElementById("grid");
        
        document.getElementById('memo_products').value= '';
        
         for (var i = 1, row; row = table_products_sale.rows[i]; i++) {
  
               my_json = my_json + '{"IDPRODUCT":' + table_products_sale.rows[i].cells[0].innerHTML + ',';
               my_json = my_json + '"QUANTITY":' + table_products_sale.rows[i].cells[3].innerHTML + ',';
               my_json = my_json + '"UNITARYVALUE":' + table_products_sale.rows[i].cells[2].innerHTML + '}'; 
  
               if (qty_commas > 0){
                   my_json = my_json + ',';
                   qty_commas = qty_commas -1;
                 } 
  
             }
        
         my_json = my_json + ']';
        
        document.getElementById('memo_products').value= my_json;
  
  
  }
  
  //----------- END - CREATE JSON PRODUCTS ----------------
  
  function create_json_installments(){
    var i;
    
         var  my_jason_installments = '['; 
       
        // -2 because the fisrt row has the name of the fields
         
         var qty_commas_installments = document.getElementById("gridbills").rows.length -2; 
  
   var table_installments_sale = document.getElementById("gridbills");
        
        document.getElementById('memo_installments').value= '';
        
         for (var i = 1, row; row = table_installments_sale.rows[i]; i++) {
  
               my_jason_installments = my_jason_installments + '{"EXPIRATION":' +'"'+ table_installments_sale.rows[i].cells[0].innerHTML + '"'+ ',';
  
              
                
                 my_jason_installments = my_jason_installments + '"NUMDOC":' + '"'+ table_installments_sale.rows[i].cells[1].innerHTML + '"'+ ',';
                    
             
               my_jason_installments = my_jason_installments + '"INSTALLMENTVALUE":' + table_installments_sale.rows[i].cells[2].innerHTML + '}'; 
  
               if (qty_commas_installments > 0){
                   my_jason_installments = my_jason_installments + ',';
                   qty_commas_installments = qty_commas_installments -1;
                 } 
  
             }
        
         my_jason_installments = my_jason_installments + ']';
        
        document.getElementById('memo_installments').value= my_jason_installments;    
      
  
  }
  
  
  
  
   // validate date
      
   function validateDate(id,field) {
             
             var my_result = true;
                  
             var RegExPattern = /^((((0?[1-9]|[12]\d|3[01])[\.\-\/](0?[13578]|1[02])      [\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|((0?[1-9]|[12]\d|30)[\.\-\/](0?[13456789]|1[012])[\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|((0?[1-9]|1\d|2[0-8])[\.\-\/]0?2[\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|(29[\.\-\/]0?2[\.\-\/]((1[6-9]|[2-9]\d)?(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00)|00)))|(((0[1-9]|[12]\d|3[01])(0[13578]|1[02])((1[6-9]|[2-9]\d)?\d{2}))|((0[1-9]|[12]\d|30)(0[13456789]|1[012])((1[6-9]|[2-9]\d)?\d{2}))|((0[1-9]|1\d|2[0-8])02((1[6-9]|[2-9]\d)?\d{2}))|(2902((1[6-9]|[2-9]\d)?(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00)|00))))$/;
       
            if (!((id.value.match(RegExPattern)) && (id.value!=''))) {
                
                
                   alert('Date must be ' + field+ 'in the format dd/mm/yyyy');
                 
                  id.focus();
                
                  my_result = false;
                
               }
                  return my_result;
       //     
           }
  
  //------------------------------------------
  
  function add_client_sale(element) {
  
  document.getElementById("id_client").value = document.getElementById("gridclientsale").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML;
  document.getElementById("client").value = document.getElementById("gridclientsale").rows[element.parentNode.parentNode.rowIndex].cells[1].innerHTML;
  
  
  
  close_modal_client();
  
  }
  //--------------------------------------------------------------
  function close_modal_client(){
      $('#modalClients').modal('hide');    
      }
  //---------------------------------------------------------
  
  function add_center_cost_sale(element) {
  
  document.getElementById("id_cost_center").value = document.getElementById("gridcost_centersale").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML;
  document.getElementById("cost_center").value = document.getElementById("gridcost_centersale").rows[element.parentNode.parentNode.rowIndex].cells[1].innerHTML;
  
  close_modal_cost_center();
  
  }
  //--------------------------------------------------------------
  function close_modal_cost_center(){
      $('#modalCostCenter').modal('hide');    
      }
  //---------------------------------------------------------
       
  function add_sale_payment_form(element) {
  
  
  
  document.getElementById("id_payment_method").value = document.getElementById("gridpayment_method_sale").rows[element.parentNode.parentNode.rowIndex].cells[0].innerHTML;
  document.getElementById("payment_method").value = document.getElementById("gridpayment_method_sale").rows[element.parentNode.parentNode.rowIndex].cells[1].innerHTML;
  
  close_modal_payment_method();
  
  }
  //--------------------------------------------------------------
  function close_modal_payment_method(){
      $('#modalPaymentMethod').modal('hide');    
      }
  //---------------------------------------------------------
  function save_sale_in_cach(){
  
  
  
    if(isNaN(convert_decimal_value(document.getElementById('v_value_disc_perc_cash').value))){
               
                swal('Warning!!!', 'Discount(%) must be a number! ', 'warning');
               
               return false;     
           }
   
  
    if(isNaN(convert_decimal_value(document.getElementById('v_value_received_cash').value))){
               
               
                swal('Warning!!!', 'Received value must be a number! ', 'warning');
               
               
               return false;     
           }
  
    create_json_products();
  
    document.getElementById("myForm").submit();
  
  }
  
  //------------------------------------------------
  
  
  
  </script>

<section class="content">
<div class="row">
    <div class="col-md-12">

        <div class="box box-primary">
                    
            
            

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalProducts">
              Add Products
            </button>

            <div class="box-body no-padding">
              <form id="myForm" role="form" action="/purchases/create" method="post" onsubmit="return check_fields()">
                <div class="box-body">

                

                  
                   <br>
                  <h3>List of Products </h3>

                  <!-- Modal -->
                  <div class="modal fade" id="modalProducts" tabindex="-1" role="dialog"  aria-labelledby="modalProductsTitle" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document" >
                      <div class="modal-content">
                        <div class="modal-header">
                          <h2 class="modal-title" id="modalProductsTitle">Products</h2>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                         </div>
                         <div class="modal-body">
                        
                      
                                <table class="table table-bordered table-striped " id="gridproducts">
                                  <thead>
                                    <tr>
                                      <th style="width: 10px">#</th>
                                      <th>Name</th>
                                      <th>Purchase Price</th>
                                      <th>Stock</th>
                                      <th>Quantity</th>
                                      <th style="width: 140px">&nbsp;</th>
                                    </tr>
                                  </thead>
                                  <tbody >
                                    {% for product in products %}
                                    <tr>
                                      <td>{{product.id}}</td>
                                      <td>{{product.name}}</td>
                                      <td>{{product.purchase_price}}</td>
                                      <td>{{product.stock}}</td>
                                      <td> <input type="text" id="qtde{{product.id}}" size="10" value="1"/> </td>
                                      <td>
                                        <button type="button" class="btn btn-xs btn-primary" data-toggle="tooltip" data-placement="top"  onclick="add_products_sale(this)">
                                          <i class="fa fa-plus"></i> Select 
                                        </button>
                                    
                                        
                                      </td>
                                    </tr>
                                    {% endfor %}
                                  </tbody>
                                </table>
                              
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          
                        </div>
                      </div>
                    </div>
                  </div>
                
                  
                    <table id="grid" class="table  table-bordered table-striped table-hover">
                      <thead>
                        <tr>
                          <th>#</th>
                          <th>Name</th>
                          <th>Price</th>
                          <th>Quantity</th>
                          <th>Subtotal</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      
                    </table>

                    
                       <div class="row justify-content-end">

                        <div class="col-md-3 col-sm-6 col-xs-12">
                          <div class="info-box">
                            <span class="info-box-icon bg-green"><i class="fa fa-cart-arrow-down"></i></span>

                            <div class="info-box-content">
                              <span class="info-box-text">Quantity Items</span>
                              <span class="info-box-number" id="qty_prod_sale">0</span>
                            </div>
                            <!-- /.info-box-content -->
                          </div>

                          <!-- /.info-box -->
                        </div>
                    
                        <div class="col-md-3 col-sm-6 col-xs-12">
                        <div class="info-box">
                          <span class="info-box-icon bg-red"><i class="fa fa-money-bill"></i> </span>
        
                          <div class="info-box-content">
                            <span class="info-box-text">Total Amount</span>
                            <span class="info-box-number" id="sale_value">0.0</span>
                          </div>
                          <!-- /.info-box-content -->
                        </div>
        
                        <!-- /.info-box -->
                      </div>
                    </div>
                  
      
                </div>
                <!-- /.box-body -->

                 <!-- Modal Clientes -->

          <div class="modal fade" id="modalClients" tabindex="-1" role="dialog" aria-labelledby="modalClientsTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title" id="modalClientsTitle">Supplier</h2>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>

                
                </div>
                <div class="modal-body">

                     
                        <table class="table table-bordered table-striped table-hover" id="gridclientsale">
                          <thead>
                            <tr>
                              <th style="width: 10px">#</th>
                              <th>Name</th>
                              <th style="width: 140px">&nbsp;</th>
                            </tr>
                          </thead>
                          <tbody >
                            {% for supplier in suppliers %}
                            <tr>
                              <td>{{supplier.id}}</td>
                              <td>{{supplier.name}}</td>
                              
                              <td>
                                <button type="button" class="btn btn-xs btn-primary" data-toggle="tooltip" data-placement="top"  onclick="add_client_sale(this)">
                                   <i class="fa fa-plus"></i> Select
                                </button>
                             
                                
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>


          <!-- END -  Modal Clientes -->

<!-- ------------------------------------------------------------------------------ -->
          <!--   Modal Cost Center -->

          <div class="modal fade" id="modalCostCenter" tabindex="-1" role="dialog" aria-labelledby="modalCostCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title" id="modalCostCenterTitle">Cost Center</h2>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>

                
                </div>
                <div class="modal-body">

                     
                        <table class="table table-bordered table-striped table-hover" id="gridcost_centersale">
                          <thead>
                            <tr>
                              <th style="width: 10px">#</th>
                              <th>Name</th>
                              <th style="width: 140px">&nbsp;</th>
                            </tr>
                          </thead>
                          <tbody >
                            {% for cost_center in costs_center %}
                            <tr>
                              <td>{{cost_center.id}}</td>
                              <td>{{cost_center.name}}</td>
                              <td>
                                <button type="button" class="btn btn-xs btn-primary" data-toggle="tooltip" data-placement="top"  onclick="add_center_cost_sale(this)">
                                   <i class="fa fa-plus"></i> Select
                                </button>
                             
                                
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>

          <!-- END -  Modal Cost Center -->
          
          <!-- Modal Payment Method -->
          <div class="modal fade" id="modalPaymentMethod" tabindex="-1" role="dialog" aria-labelledby="modalPaymentMethodTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title" id="modalPaymentMethodTitle">Payment Method</h2>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>

                
                </div>
                <div class="modal-body">

                     
                        <table class="table table-bordered table-striped table-hover" id="gridpayment_method_sale">
                          <thead>
                            <tr>
                              <th style="width: 10px">#</th>
                              <th>Name</th>
                              <th style="width: 140px">&nbsp;</th>
                            </tr>
                          </thead>
                          <tbody >
                            {% for payment_method in payment_methods %}
                            <tr>
                              <td>{{payment_method.id}}</td>
                              <td>{{payment_method.name}}</td>
                              <td>
                                <button type="button" class="btn btn-xs btn-primary" data-toggle="tooltip" data-placement="top"  onclick="add_sale_payment_form(this)">
                                   <i class="fa fa-plus"></i> Select
                                </button>
                             
                                
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>







          <!-- END -  Modal Payment Method -->
          
          <!--  Cash payment -->
          <div class="modal fade" id="modalSaleCash" tabindex="-1" role="dialog" aria-labelledby="modalSaleCashTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title" id="modalSaleCashTitle">Cash Purchase</h2>
                  
                
                </div>
                <div class="modal-body">
                  <div class="row">
                        <div class="col-md-4 col-sm-6 col-xs-12">
                          <div class="info-box">
                            <span class="info-box-icon bg-green"><i class="fa fa-money-bill"></i></span>

                            <div class="info-box-content">
                              <span class="info-box-text">Purchase Value</span>
                              <span class="info-box-number" id="v_sale_value_cash" ></span>
                            </div>
                            <!-- /.info-box-content -->
                          </div>

                          <!-- /.info-box -->
                       </div>

                       <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="info-box">
                          <span class="info-box-icon bg-blue"><i class="fa fa-money-bill"></i></span>

                          <div class="info-box-content">
                            <span class="info-box-text">Discount(%)</span>
                            <span class="info-box-number" ><input type="text" class="form-control" id="v_value_disc_perc_cash" name="v_value_disc_perc_cash"   ></span>
                          </div>

                          <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                       </div>

                       <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="info-box">
                          <span class="info-box-icon bg-green"><i class="fa fa-money-bill"></i></span>

                          <div class="info-box-content">
                            <span class="info-box-text">Discounted Value</span>
                            <span class="info-box-number" ><input type="text" class="form-control" id="v_sale_value_after_desc" name="v_sale_value_after_desc" value="0" readonly ></span>
                          </div>

                          <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                       </div>


                  </div>
                  <div class="row">
                            <div class="col-md-4 col-sm-6 col-xs-12">
                              <div class="info-box">
                                <span class="info-box-icon bg-blue"><i class="fa fa-money-bill"></i></span>

                                <div class="info-box-content">
                                  <span class="info-box-text">Value Received </span>
                                  <span class="info-box-number"  ><input type="text" class="form-control" id="v_value_received_cash" name="v_value_received_cash"></span>
                                </div>
                                <!-- /.info-box-content -->
                              </div>

                              <!-- /.info-box -->
                        </div>

                                 
                            <div class="col-md-4 col-sm-6 col-xs-12">
                              <div class="info-box">
                                <span class="info-box-icon bg-green"><i class="fa fa-money-bill"></i></span>
    
                                <div class="info-box-content">
                                  <span class="info-box-text">Change</span>
                                  <span class="info-box-number"  ><input type="text" class="form-control" id="v_change_incache" name="v_change_incache" value="0" readonly></span>
                                </div>
                                <!-- /.info-box-content -->
                              </div>
    
                              <!-- /.info-box -->
                        </div>




                  </div>

                       
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-success" onclick=" return save_sale_in_cach();">Save Purchase</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>




          <!-- END-  Cash payment -->
              


          <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="callout callout-info">
                     <h4>Purchase Data</h4>
                </div> 
                
            </div>
          </div>
 
          <div class="row">
            <div class="col-xs-6 col-md-3">
                <div class="form-group hidden">
                  <input type="hidden" class="form-control" id="id_client" name="id_client" readonly >
                </div>

                <div class="form-group">
                  <label for="client">Supplier:</label>
                  <input type="text" class="form-control" id="client" name="client" readonly >
                </div>

                 <!-- Button trigger modal -->
                 <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalClients">
                  Select Supplier
                </button>
              </div>
              
              
                 
              
              <div class="col-xs-6 col-md-3">

                <div class="form-group hidden">
                  <input type="hidden" class="form-control" id="id_cost_center" name="id_cost_center" readonly >
                </div>

                <div class="form-group">
                  <label for="cost_center">Cost Center:</label>
                  <input type="text" class="form-control" id="cost_center" name="cost_center" readonly >
                </div>

                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalCostCenter">
                  Select Cost Center
                </button>


             
             </div>
            
            
            
           
         <div class="col-xs-6 col-md-3">

          <div class="form-group hidden">
            <input type="hidden" class="form-control" id="id_payment_method" name="id_payment_method" readonly >
          </div>

          <div class="form-group">
            <label for="payment_method">Payment Method:</label>
            <input type="text" class="form-control" id="payment_method" name="payment_method" readonly >
          </div>

              <!-- Button trigger modal -->
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalPaymentMethod">
                Select Payment Method
              </button>

          </div>   

  
              
         </div>
       
          <div class="row">

              <div class="col-xs-6 col-md-3">

                <div class="form-group">
                  <label for="tax_invoice">Tax Invoice:</label>
                  <input type="text" class="form-control" id="tax_invoice" name="tax_invoice" >
                </div>

              </div>

              <div class="col-xs-6 col-md-2">
                <div class="form-group">
                  <label for="date_sale" class="text-red">Date:</label>
                  <input type="date" class="form-control" id="date_sale" name="date_sale" >
                </div> 
      

          </div>
        </div>
  





                <div class="box-footer">

                  <div class="form-group hidden">
                    <label hidden for="memo_products">Memo products:</label>
                    <input type="hidden" class="form-control" id="memo_products" name="memo_products" >
                  </div>
  
                  <div class="form-group hidden">
                    <label hidden for="memo_installments">Memo installments:</label>
                    <input type="hidden" class="form-control" id="memo_installments" name="memo_installments" >
                  </div>



                </div>

                <div class="row">
                  <!-- <div class="col-xs-9 col-md-4">-->
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                      <div class="callout callout-danger">
                            <h4>Purchase Payment</h4>
                      </div>
                      
                  </div>
                      
                </div>

                <div class="row">
                  <div class="col-xs-9 col-md-4">
                    <div class="checkbox" >
                        <h3><label  class="text-red"><input type="checkbox" id="check_in_cash" name="check_in_cash">In Cash</label></h3>
                    </div>
                  </div>  
                    
                </div>
                <div class="row">
                    <div class="col-xs-9 col-md-4">
                        <h3 class="text-light-blue">Installment</h3> 
                        
                    </div>
                </div>

                <div class="row">
                  <div class="col-xs-6 col-md-2">
                          <div class="form-group" >
                              <label>Expiration:</label>
                              <input type="date" class="form-control" id="v_expiration_date_account" name="v_expiration_date_account" >
                          </div>
                    </div>
                   
                       <div class="col-xs-6 col-md-2">
                          <div class="form-group" >
                              <label for="v_number_account_document">Num. Doc.</label>
                              <input type="text" class="form-control" id="v_number_account_document" name="v_number_account_document">
                              
                          </div>
                      </div>
                   
                       <div class="col-xs-6 col-md-2">
                          <div class="form-group">
                              <label for="v_value_installment_account" >Installment Value</label>
                              <input type="text" class="form-control" id="v_value_installment_account" name="v_value_installment_account">
                          </div>
                      </div>
                        <div class="col-xs-6 col-md-3"> 
                      
                            <br />
                             <button type="button" class="btn btn-primary"  onclick="add_installment_sale()">
                              &nbsp;&nbsp;<i class="fa fa-plus" aria-hidden="true"></i> Add &nbsp;&nbsp;
                              </button>
                        </div>
                  
              
              </div>
              <div class="row">
                <div class="col-md-12">
                            <br />
            <!-- TABLE TO DISPLAY PURCHASE INSTALLMENTS -->                 
                             <div class="table-responsive">
                                <table id="gridbills" class="table table-bordered table-striped table-hover "> 
                                    <thead>
                                        <tr>
                                            <th style="text-align: left;">Expiration</th>
                                            <th style="text-align: left;">Document</th>
                                            <th style="text-align: left;">Value</th>
                                            <th style="text-align: left;">Actions</th>
                                        </tr>
                                    </thead>
                                
                                </table>
                                
                                
                            </div> 
                 <!-- END - TABLE TO DISPLAY SALE INSTALLMENTS -->
                </div>
            </div>

            
              <div class="row justify-content-end">
                   
              <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon bg-green"><i class="fa fa-money-bill"></i></span>
  
                      <div class="info-box-content">
                        <span class="info-box-text">Accumulated value</span>
                        <span class="info-box-number" id="value_released_installments">0.0</span>
                      </div>
                      <!-- /.info-box-content -->
                    </div>
  
                    <!-- /.info-box -->
              </div>
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon bg-blue"><i class="fa fa-money-bill"></i></span>
  
                      <div class="info-box-content">
                        <span class="info-box-text">Balance</span>
                        <span class="info-box-number" id="value_balance_installment">0.0</span>
                      </div>
                      <!-- /.info-box-content -->
                    </div>
  
                    <!-- /.info-box -->
              </div>
             
         </div>

         <div class="row">
          <div class="col-md-12">
              <button type="button" class="btn btn-success btn-lg btn-block" onclick="check_fields()">Save</button>
              
          </div>
          
          </div>
  
      
              </form>
                
            </div>
        <!-- /.box-body -->
        </div>
     </div>
</div>   
</section>
{% endblock %}

